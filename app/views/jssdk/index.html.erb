<div id="fb-root"></div>
<script>
  window.fbAsyncInit = function() {
    // init the FB JS SDK
    FB.init({
      appId      : '213223128832848',                        // App ID from the app dashboard
      channelUrl : '//www.radiant-island-4482.herokuapp.com/channel.html', // Channel file for x-domain comms
      status     : true,                                 // Check Facebook Login status
      xfbml      : true                                  // Look for social plugins on the page
    });

    // Additional initialization code such as adding Event Listeners goes here
    $(document).trigger('fbload');
  
  };

  // Load the SDK asynchronously
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/all.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));


  $(document).on('fbload',  //  <---- HERE'S OUR CUSTOM EVENT BEING LISTENED FOR
    function(){
      $.ajaxSetup({ cache: true });
      $.getScript('//connect.facebook.net/en_UK/all.js', function(){
        // FB.init({
        //   appId: '213223128832848',
        //   channelUrl: '//www.radiant-island-4482.herokuapp.com/channel.html',
        // });     
        $('#loginbutton,#feedbutton').removeAttr('disabled');
        
        $("#getStarted").on('click', function() {
          FB.login(function(response){
            alert('Logged in');
          });
        });

        $("#logOut").on('click', function() {
          FB.logout(function(response){
              alert('Logged out');
            });
        });

        FB.getLoginStatus(function(response) {
            if (response.status === 'connected') {
              // the user is logged in and has authenticated your
              // app, and response.authResponse supplies
              // the user's ID, a valid access token, a signed
              // request, and the time the access token 
              // and signed request each expire
              var uid = response.authResponse.userID;
              var accessToken = response.authResponse.accessToken;
              var expiresIn = response.authResponse.expiresIn;
              var signedRequest = response.authResponse.signedRequest;
              $('#user').html('user id:' + uid);
              $('#user').append('<br/> access token: ' + accessToken);
              $('#user').append('<br/> expires in: ' + expiresIn);
              $('#user').append('<br/> signed request: ' + signedRequest);
              return uid;


            FB.api(uid, function(user) {
              if (user.authResponse) {
                var username = user.username;
                $('#welcome').html('Hello, ' + username + '.' );
                console.log('Good to see you, ' + username + '.');
              }
              else {
                console.log('User cancelled login or did not fully authorize.');
              }
            });

            } else if (response.status === 'not_authorized') {
              // the user is logged in to Facebook, 
              // but has not authenticated your app
              console.log('app not authorised');
            } else {
              // the user isn't logged in to Facebook.
              console.log('not logged in to Facebook');
            }
           });

      
          // FB.api('/me', function(response) {
          //   if (response.authResponse) {
          //     var me = response.username;
          //     $('#welcome').html('Hello, ' + me + '.' );
          //     console.log('Good to see you, ' + me + '.');
          //   }
          //   else {
          //     console.log('User cancelled login or did not fully authorize.');
          //   }
          // });

      
      });


  });          




</script>

<h1>JS SDK App</h1>
<h2 id="welcome"></h2>

<p id="user"></p>

<button id="getStarted" >Log in</button>
<button id="logOut" >Logout</button>

